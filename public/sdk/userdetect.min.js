var UserDetect=function(e){"use strict";const t="__ud_fp";function n(){try{const e=document.createElement("canvas");e.width=200,e.height=50;const t=e.getContext("2d");return t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("UserDetect,fp!",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("UserDetect,fp!",4,17),t.beginPath(),t.arc(50,25,10,0,2*Math.PI),t.fillStyle="#f0f",t.fill(),e.toDataURL()}catch(e){return""}}function o(){try{const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"";const n=t.getExtension("WEBGL_debug_renderer_info"),o=n?t.getParameter(n.UNMASKED_VENDOR_WEBGL):"";return`${o}~${n?t.getParameter(n.UNMASKED_RENDERER_WEBGL):""}`}catch(e){return""}}function r(){try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return"";const t=new e,n=t.createOscillator(),o=t.createAnalyser(),r=t.createGain(),a=t.createScriptProcessor(4096,1,1);n.type="triangle",n.frequency.setValueAtTime(1e4,t.currentTime),r.gain.setValueAtTime(0,t.currentTime),n.connect(o),o.connect(a),a.connect(r),r.connect(t.destination);const i=new Float32Array(o.frequencyBinCount);return o.getFloatFrequencyData(i),t.close(),i.slice(0,30).join(",")}catch(e){return""}}function a(){const e=["monospace","sans-serif","serif"],t=document.body,n=document.createElement("span");n.style.fontSize="72px",n.style.position="absolute",n.style.left="-9999px",n.textContent="mmmmmmmmlli",t.appendChild(n);const o={};e.forEach(e=>{n.style.fontFamily=e,o[e]=n.offsetWidth});const r=[];return["Arial","Courier New","Georgia","Times New Roman","Trebuchet MS","Verdana","Comic Sans MS","Impact","Lucida Console","Tahoma","Palatino","Garamond","Bookman","Arial Black","Calibri"].forEach(t=>{e.some(e=>(n.style.fontFamily=`'${t}', ${e}`,n.offsetWidth!==o[e]))&&r.push(t)}),t.removeChild(n),r.join(",")}async function i(){try{const e=sessionStorage.getItem(t);if(e)return e}catch(e){}const e=[n(),o(),r(),a(),`${screen.width}x${screen.height}x${screen.colorDepth}x${window.devicePixelRatio||1}`,Intl.DateTimeFormat().resolvedOptions().timeZone,navigator.language,navigator.platform,navigator.hardwareConcurrency||0,navigator.deviceMemory||0,navigator.maxTouchPoints||0,(new Date).getTimezoneOffset()].join("|||"),i=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}(e);try{sessionStorage.setItem(t,i)}catch(e){}return i}const c="https://www.cloudflare.com/cdn-cgi/trace",s=new Set(["as","bn","bho","doi","gu","hi","kn","kok","mai","ml","mni","mr","ne","or","pa","sat","sd","ta","te","ur"]),l=["Shruti","Lohit Gujarati","Noto Sans Gujarati","Gujarati Sangam MN","Lohit Tamil","Noto Sans Tamil","Tamil Sangam MN","InaiMathi","Lohit Telugu","Noto Sans Telugu","Telugu Sangam MN","Vrinda","Lohit Bengali","Noto Sans Bengali","Bangla Sangam MN","Tunga","Lohit Kannada","Noto Sans Kannada","Kannada Sangam MN","Kartika","Lohit Malayalam","Noto Sans Malayalam","Malayalam Sangam MN","Raavi","Lohit Punjabi","Noto Sans Gurmukhi","Gurmukhi Sangam MN","Kalinga","Lohit Odia","Noto Sans Oriya","Oriya Sangam MN"];function u(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return null}}function d(e){if(!Array.isArray(e)||0===e.length)return null;const t=e.map((e,t)=>{const n=(e||"").toString().trim(),o=n.split("-")[0].toLowerCase();return s.has(o)?{code:n||o,language:o,position:t}:null}).filter(Boolean);return 0===t.length?null:{regional:t,total_languages:e.length}}async function m(){const e={},[t,n]=await Promise.all([f(),g()]);t&&(e.cf_trace=t),n&&(e.webrtc=n);const o=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return o&&(e.connection={type:o.type||null,effective_type:o.effectiveType||null,rtt:void 0!==o.rtt?o.rtt:null,downlink:void 0!==o.downlink?o.downlink:null}),Object.keys(e).length>0?e:null}async function f(){const e=(await Promise.all(Array.from({length:3},()=>async function(){if("undefined"==typeof fetch||"undefined"==typeof performance)return null;const e=new AbortController,t=setTimeout(()=>e.abort(),2500);try{const n=performance.now(),o=await fetch(c,{method:"GET",cache:"no-store",signal:e.signal}),r=Math.round(performance.now()-n);if(clearTimeout(t),!o.ok)return null;const a=await o.text(),i=e=>{const t=a.match(new RegExp(e+"=([^\\n]+)"));return t?t[1].trim():null},s=i("colo"),l=i("ip");return s?{colo:s,ip:l,rtt_ms:r}:null}catch(e){return clearTimeout(t),null}}()))).filter(Boolean);if(0===e.length)return null;return{...e.reduce((e,t)=>e.rtt_ms<=t.rtt_ms?e:t),samples:e.length}}async function g(){return"undefined"==typeof RTCPeerConnection?null:new Promise(e=>{const t=new Set;let n=!1;const o=()=>{if(n)return;n=!0;try{r.close()}catch(e){}if(0===t.size)return void e(null);const o=Array.from(t);e({local_ips:o,connection_type:h(o[0])})},r=new RTCPeerConnection({iceServers:[]});r.createDataChannel("__probe__"),r.onicecandidate=e=>{if(!e.candidate)return void o();const n=e.candidate.candidate.split(" "),r=n[7],a=n[4];"host"===r&&a&&!a.endsWith(".local")&&t.add(a)},r.createOffer().then(e=>r.setLocalDescription(e)).catch(()=>o()),setTimeout(o,2e3)})}function h(e){return e?/^100\.(6[4-9]|[7-9]\d|1[0-1]\d|12[0-7])\./.test(e)?"cgn_cellular":/^10\./.test(e)||/^172\.(1[6-9]|2\d|3[0-1])\./.test(e)||/^192\.168\./.test(e)?"private_wifi":/^169\.254\./.test(e)?"link_local":"unknown":"unknown"}function y(){if("undefined"==typeof document||!document.body)return[];const e=["monospace","sans-serif","serif"],t=document.createElement("span");t.style.fontSize="72px",t.style.position="absolute",t.style.left="-9999px",t.textContent="mmmmmmmmlli",document.body.appendChild(t);const n={};e.forEach(e=>{t.style.fontFamily=e,n[e]=t.offsetWidth});const o=[];return l.forEach(r=>{e.some(e=>(t.style.fontFamily=`'${r}', ${e}`,t.offsetWidth!==n[e]))&&o.push(r)}),document.body.removeChild(t),o}async function p(e,t,n){const o=(n.apiEndpoint||"").replace(/\/$/,"")+"/v1/detect",r=n.timeout||1e4,a=JSON.stringify({signals:t,options:{return_alternatives:n.returnAlternatives||!1,include_debug_info:n.debug||!1}}),i={"Content-Type":"application/json","X-API-Key":e};try{return await w(o,i,a,r)}catch(e){n.debug&&console.warn("[UserDetect] First attempt failed, retrying...",e.message),await(c=1e3,new Promise(e=>setTimeout(e,c)));try{return await w(o,i,a,r)}catch(e){return{success:!1,error:{code:e.code||"NETWORK_ERROR",message:e.message||"Failed to connect to detection API."},request_id:e.request_id||null}}}var c}async function w(e,t,n,o){const r=new AbortController,a=setTimeout(()=>r.abort(),o);try{const o=await fetch(e,{method:"POST",headers:t,body:n,signal:r.signal});clearTimeout(a);const i=await o.json().catch(()=>({}));return o.ok?i:{success:!1,error:i.error||{code:"HTTP_ERROR",message:`HTTP ${o.status}: ${o.statusText}`},request_id:i.request_id||null}}catch(e){if(clearTimeout(a),"AbortError"===e.name){const e=new Error("Request timeout");throw e.code="NETWORK_TIMEOUT",e}const t=new Error(e.message||"Network request failed");throw t.code="NETWORK_ERROR",t}}let _=null,T={},S=null,b=null,v=null,E=!1;const D={apiEndpoint:"",timeout:1e4,debug:!1,autoDetect:!0,returnAlternatives:!1,onEvent:null};async function R(){if(!E)throw new Error("[UserDetect] SDK not initialized. Call UserDetect.init() first.");let e;A("detect_started",{timestamp:Date.now()}),T.debug&&console.log("[UserDetect] Starting detection...");try{const[t,n]=await Promise.all([i(),m().catch(()=>null)]);v=t,T.debug&&(console.log("[UserDetect] Fingerprint:",v),console.log("[UserDetect] Network probes:",n));const o=function(e){const t=Array.from(navigator.languages||[]);return{fingerprint:e,timezone:u(),timezone_offset:(new Date).getTimezoneOffset(),language:navigator.language||null,languages:t,language_analysis:d(t),regional_fonts:y(),user_agent:navigator.userAgent,screen:{width:screen.width,height:screen.height,color_depth:screen.colorDepth,pixel_ratio:window.devicePixelRatio||1},platform:navigator.platform||null,hardware_concurrency:navigator.hardwareConcurrency||null,device_memory:navigator.deviceMemory||null}}(v);n&&(o.network_probes=n),T.debug&&console.log("[UserDetect] Signals:",o),e=await p(_,o,T)}catch(t){e={success:!1,error:{code:"SDK_ERROR",message:t&&t.message||"SDK detection failed before API request."}}}return b=e,A(e.success?"detect_succeeded":"detect_failed",{success:e.success,error:e.error||null,request_id:e.request_id||null}),T.debug&&console.log("[UserDetect] Result:",e),S&&S(e),e}function A(e,t){if("function"==typeof T.onEvent)try{T.onEvent({name:e,payload:t||{}})}catch(e){}}return e.detect=R,e.getLastDetection=function(){return b},e.getUserId=function(){return v},e.init=function(e,t,n){e?"function"==typeof t?(_=e,S=t,T=Object.assign({},D,n||{}),E=!0,T.apiEndpoint||(T.apiEndpoint=function(){try{const e=document.getElementsByTagName("script");for(let t=e.length-1;t>=0;t--){const n=e[t].src||"";if(n.includes("userdetect")){return new URL(n).origin+"/api"}}}catch(e){}return window.location.origin+"/api"}()),T.debug&&console.log("[UserDetect] Initialized with options:",T),T.autoDetect&&R().catch(function(e){const t={success:!1,error:{code:"SDK_ERROR",message:e&&e.message||"Auto-detect failed."}};b=t,S&&S(t),T.debug&&console.error("[UserDetect] Auto-detect failed:",e)})):console.error("[UserDetect] Callback function is required."):console.error("[UserDetect] API key is required.")},e}({});
